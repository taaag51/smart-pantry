# スマートパントリーアプリケーション アーキテクチャ設計

## 概要

このアプリケーションは、食材管理を効率化するための Web アプリケーションです。
フロントエンドは React、バックエンドは Go 言語で実装されています。

## アーキテクチャの特徴

### フロントエンド（React + TypeScript）

#### コンポーネント設計

1. **プレゼンテーショナルコンポーネント**

   - UI の表示に特化
   - ビジネスロジックを含まない
   - 例：`FoodItemForm.tsx`

2. **カスタムフック**
   - ビジネスロジックの分離
   - 再利用可能な状態管理
   - 例：`useFoodItemForm.ts`, `useMutateFoodItem.ts`

#### 状態管理

- React Query による効率的なサーバー状態管理
- ローカル状態は React の useState を使用
- キャッシュの最適化

### バックエンド（Go + Echo）

#### レイヤードアーキテクチャ

1. **コントローラー層**

   - HTTP リクエストのハンドリング
   - バリデーション
   - レスポンス形式の統一

   ```go
   type Response struct {
       Data    interface{} `json:"data"`
       Message string      `json:"message,omitempty"`
   }
   ```

2. **ユースケース層**

   - ビジネスロジックの実装
   - トランザクション管理

3. **リポジトリ層**
   - データベースアクセス
   - データの永続化

## データフロー

### 食材追加の例

1. ユーザーが食材フォームに入力
2. `FoodItemForm` コンポーネントが入力を受け取る
3. `useFoodItemForm` フックがバリデーションを実行
4. `useMutateFoodItem` フックが API リクエストを送信
5. バックエンドの `FoodItemController` がリクエストを受信
6. ユースケース層でビジネスロジックを実行
7. データベースに保存
8. レスポンスをフロントエンドに返却
9. React Query がキャッシュを更新
10. UI が自動的に更新

## エラーハンドリング

### フロントエンド

- カスタムフックによる一元化されたエラー処理
- ユーザーフレンドリーなエラーメッセージ
- フォームバリデーション

### バックエンド

- 統一されたエラーレスポンス形式
- 適切な HTTP ステータスコードの使用
- 詳細なエラーメッセージ

## セキュリティ

- JWT による認証
- CSRF トークンの使用
- 入力値のバリデーション
- SQL インジェクション対策

## パフォーマンス最適化

### フロントエンド

- React Query によるキャッシュ管理
- 必要最小限のレンダリング
- コンポーネントの適切な分割

### バックエンド

- データベースクエリの最適化
- キャッシュの活用
- 効率的なルーティング

## 開発ガイドライン

1. **コンポーネント作成**

   - 単一責任の原則に従う
   - プレゼンテーショナルとコンテナの分離
   - 適切なコメント付与

2. **カスタムフック作成**

   - ロジックの再利用性を重視
   - 明確な命名規則
   - 型定義の徹底

3. **API エンドポイント作成**

   - RESTful 原則に従う
   - 統一されたレスポンス形式
   - 適切なエラーハンドリング

4. **テスト**
   - ユニットテストの作成
   - インテグレーションテスト
   - E2E テスト

## 今後の改善点

1. キャッシュ戦略の最適化
2. パフォーマンスモニタリングの導入
3. エラーログの集中管理
4. CI/CD パイプラインの強化
